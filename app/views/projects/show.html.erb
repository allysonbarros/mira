<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Project Overview</h3>
  </div>

  <%= render 'error_messages' %>

  <div class="panel-body">

    <%= render 'projects/partials/project_details' %><br />

    <div class="col-md-12">


      <% if @datapackage.present? %>
        <table class="table">
          <tr>
            <th>Datapackage</th>
            <th>Created</th>
          </tr>
          <tr>
            <td><%= link_to @datapackage.datapackage_file_name, @datapackage.datapackage.url %></td>
            <th><%= @datapackage.created_at.strftime("%FT%R") %></td>
          </tr>
        </table>


        <table class="table">
          <tr>
            <th>Datasources listed <br />in datapackage.json</th>
            <th>Status</th>
          </tr>
          <% @datapackage.datapackage_resources.each do |res| %>
            <tr>
              <td><%= res.path %></td>
              <td>
                <% if res.datasource_id.present? %>
                  Yippee...something uploaded. Update this!
                <% else %>
                  Not uploaded yet
                <% end %>
              </td>
            </tr>
            <% end %>
        </table>


      <% else %>
        <p>A datapackage.json file has not yet been uploaded and processed.</p>
      <% end %>


      <br />
      <% if @datasources.present? %>
        <table class="table">
          <tr>
            <th>Data source</th>
            <th>Created</th>
            <% if user_signed_in? %>
              <th>Process Log</th>
            <% end %>
          </tr>

          <% @datasources.each do |ds| %>
            <tr>
              <td><%= link_to ds.datafile_file_name, ds.datafile.url %></td>
              <th><%= ds.created_at.strftime("%FT%R") %></td>
              <% if user_signed_in? %>
                <td><a href="/job_logs/project_<%= ds.project_id %>/<%= ds.datafile_file_name %>.log"><%= ds.datafile_file_name %>.log</a></td>
                <th><%= link_to "delete", project_datasource_path(ds.project_id, ds.id), method: :delete,
                                data: { confirm: "You sure?" }, :class => "btn btn-xs btn-danger" %></th>
              <% end %>
            </tr>
          <% end %>
        </table>
      <% end %>


      <% if user_signed_in? %>
        <% if @log_file_names.present? %>
          <p>All log files</p>
          <ul>
            <% @log_file_names.each do |lf| %>
              <li><a href="<%= root_url %>job_logs/project_<%= @project.id %>/<%= lf %>"><%= lf %></a>
            <% end %>
          </ul>
        <% end %>
      <% end %>
    </div>
  </div>
</div>

<% if user_signed_in? %>
  <% if !@datapackage %>
    <%= render :partial => 'upload_datapackage' %>
  <% else %>
    <%= render :partial => 'upload_datasources' %>
  <% end %>
<% end %>
